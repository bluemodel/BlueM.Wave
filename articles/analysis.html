<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Adding a new analysis function | BlueM.Wave </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Adding a new analysis function | BlueM.Wave ">
      
      
      <link rel="icon" href="../images/wave_icon.png">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/bluemodel/BlueM.Wave/blob/master/docs/articles/analysis.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../images/wave_logo.png" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="adding-a-new-analysis-function">Adding a new analysis function</h1>

<p>To add a new analysis function in Wave</p>
<ol>
<li>write a new analysis function class that inherits from <code>Analysis</code></li>
<li>add the new analysis function to the <code>AnalysisFactory</code></li>
</ol>
<h2 id="1-create-a-new-analysis-class">1. Create a new analysis class</h2>
<p>The new analysis class must inherit from <code>Analysis</code>. It receives a list of input time series and can produce text, values, a chart, a table and/or a list of result time series.</p>
<p>Example <code>Analysis\TestAnalysis.vb</code>:</p>
<pre><code class="lang-vb">'BlueM.Wave
'Copyright (C) BlueM Dev Group
'&lt;https://www.bluemodel.org&gt;
'
'This program is free software: you can redistribute it and/or modify
'it under the terms of the GNU Lesser General Public License as published by
'the Free Software Foundation, either version 3 of the License, or
'(at your option) any later version.
'
'This program is distributed in the hope that it will be useful,
'but WITHOUT ANY WARRANTY; without even the implied warranty of
'MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
'GNU Lesser General Public License for more details.
'
'You should have received a copy of the GNU Lesser General Public License
'along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.
'

''' &lt;summary&gt;
''' Write description!
''' &lt;/summary&gt;
''' &lt;remarks&gt;https://wiki.bluemodel.org/index.php/Wave:TestAnalysis&lt;/remarks&gt;
Friend Class TestAnalysis
    Inherits Analysis

    'fields for storing stuff
    Private timeseries_input As TimeSeries  'Time series to be analyzed
    Private title As String                 'Title of the time series
    Private length As Integer               'Count of the time series values
    Private timeseries_output As TimeSeries 'Result time series

    ''' &lt;summary&gt;
    ''' Returns the description of the analysis function
    ''' &lt;/summary&gt;
    Public Overloads Shared Function Description() As String
        Return &quot;Write description!&quot;
    End Function

    ''' &lt;summary&gt;
    ''' Flag indicating whether the analysis function produces a result text
    ''' &lt;/summary&gt;
    Public Overrides ReadOnly Property hasResultText() As Boolean
        Get
            Return True
        End Get
    End Property

    ''' &lt;summary&gt;
    ''' Flag indicating whether the analysis function produces result values
    ''' &lt;/summary&gt;
    Public Overrides ReadOnly Property hasResultValues() As Boolean
        Get
            Return True
        End Get
    End Property

    ''' &lt;summary&gt;
    ''' Flag indicating whether the analysis function produces a result chart
    ''' &lt;/summary&gt;
    Public Overrides ReadOnly Property hasResultChart() As Boolean
        Get
            Return True
        End Get
    End Property

    ''' &lt;summary&gt;
    ''' Flag indicating whether the analysis function has result series
    ''' that should be added to the main diagram
    ''' &lt;/summary&gt;
    Public Overrides ReadOnly Property hasResultSeries() As Boolean
        Get
            Return True
        End Get
    End Property

    ''' &lt;summary&gt;
    ''' Flag indicating whether the analysis function has a result table
    ''' that should be shown in a separate window
    ''' &lt;/summary&gt;
    Public Overrides ReadOnly Property hasResultTable() As Boolean
        Get
            Return True
        End Get
    End Property

    ''' &lt;summary&gt;
    ''' Class constructor
    ''' &lt;/summary&gt;
    ''' &lt;param name=&quot;timeseries&quot;&gt;list of time series to be analyzed&lt;/param&gt;
    Public Sub New(ByRef timeseries As List(Of TimeSeries))

        'Call constructor of base class
        Call MyBase.New(timeseries)

        'Check expected count of time series
        If (timeseries.Count &lt;&gt; 1) Then
            Throw New Exception(&quot;The TestAnalysis requires the selection of exactly one time series!&quot;)
        End If

    End Sub

    ''' &lt;summary&gt;
    ''' Process the analysis
    ''' &lt;/summary&gt;
    Public Overrides Sub ProcessAnalysis()

        'Get time series from list (`InputTimeSeries` defined in base class)
        timeseries_input = InputTimeSeries.Item(0)

        'Get values from input time series
        title = timeseries_input.Title
        length = timeseries_input.Length
        '...
        '...

        'Implement analysis here ...

        'Optional: display a progress bar
        MyBase.AnalysisProgressStart(100)
        '...
        MyBase.AnalysisProgressUpdate(50)
        '...
        MyBase.AnalysisProgressFinish()

        'store result for later
        timeseries_output = timeseries_input.Clone()

    End Sub

    ''' &lt;summary&gt;
    ''' Prepare the results of the analysis
    ''' &lt;/summary&gt;
    Public Overrides Sub PrepareResults()

        'Result text (will be shown in WaveLog)
        MyBase.ResultText = &quot;Success!&quot;

        'Result values (will be shown in WaveLog)
        MyBase.ResultValues.Add($&quot;Count values of time series '{title}'&quot;, length)

        'Result chart (will be shown in separate window)
        MyBase.ResultChart = New Steema.TeeChart.Chart()
        'Fill and format chart
        '...
        '...

        'Result table (will be shown in separate window)
        MyBase.ResultTable = New DataTable(&quot;Test analysis result&quot;)
        'add columns and rows as needed
        '...
        '...

        'List of result series (will be loaded in main window)
        MyBase.ResultSeries = New List(Of TimeSeries) From {timeseries_output}

    End Sub

End Class
</code></pre><h2 id="2-add-the-new-analysis-function-to-the-analysisfactory">2. Add the new analysis function to the <code>AnalysisFactory</code></h2>
<p>Add the new analysis function to the AnalysisFactory (file <code>Analysis\AnalysisFactory.vb</code>). The locations to edit are highlighted below and marked with <code>EDIT THIS</code>.</p>
<pre><code class="lang-vb" highlight-lines="42,82-83,146-147">'BlueM.Wave
'Copyright (C) BlueM Dev Group
'&lt;https://www.bluemodel.org&gt;
'
'This program is free software: you can redistribute it and/or modify
'it under the terms of the GNU Lesser General Public License as published by
'the Free Software Foundation, either version 3 of the License, or
'(at your option) any later version.
'
'This program is distributed in the hope that it will be useful,
'but WITHOUT ANY WARRANTY; without even the implied warranty of
'MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
'GNU Lesser General Public License for more details.
'
'You should have received a copy of the GNU Lesser General Public License
'along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.
'
''' &lt;summary&gt;
''' Factory for creating analysis instances
''' &lt;/summary&gt;
Friend Module AnalysisFactory

    ''' &lt;summary&gt;
    ''' List of analysis functions
    ''' &lt;/summary&gt;
    Public Enum AnalysisFunctions
        Accumulate
        AnnualRecurrenceProbability
        AnnualStatistics
        Autocorrelation
        Calculator
        ChangeTimestep
        Comparison
        Decumulate
        DoubleSumCurve
        GoodnessOfFit
        Histogram
        LinearRegression
        MonthlyStatistics
        TimeShift
        TimestepAnalysis
        'TestAnalysis    'EDIT THIS
    End Enum

    ''' &lt;summary&gt;
    ''' Returns a text description of the analysis function
    ''' &lt;/summary&gt;
    ''' &lt;param name=&quot;analysisfunction&quot;&gt;&lt;/param&gt;
    ''' &lt;returns&gt;&lt;/returns&gt;
    Public Function getAnalysisDescription(analysisfunction As AnalysisFunctions) As String
        Select Case analysisfunction
            Case AnalysisFunctions.Accumulate
                Return Accumulate.Description
            Case AnalysisFunctions.AnnualRecurrenceProbability
                Return AnnualRecurrenceProbability.Description
            Case AnalysisFunctions.AnnualStatistics
                Return AnnualStatistics.Description
            Case AnalysisFunctions.Autocorrelation
                Return Autocorrelation.Description
            Case AnalysisFunctions.Calculator
                Return Calculator.Description
            Case AnalysisFunctions.ChangeTimestep
                Return ChangeTimestep.Description
            Case AnalysisFunctions.Comparison
                Return Comparison.Description
            Case AnalysisFunctions.Decumulate
                Return Decumulate.Description
            Case AnalysisFunctions.DoubleSumCurve
                Return DoubleSumCurve.Description
            Case AnalysisFunctions.GoodnessOfFit
                Return GoodnessOfFit.Description
            Case AnalysisFunctions.Histogram
                Return Histogram.Description
            Case AnalysisFunctions.LinearRegression
                Return LinearRegression.Description
            Case AnalysisFunctions.MonthlyStatistics
                Return MonthlyStatistics.Description
            Case AnalysisFunctions.TimeShift
                Return TimeShift.Description
            Case AnalysisFunctions.TimestepAnalysis
                Return TimeStepAnalysis.Description
                'Case AnalysisFunctions.TestAnalysis    'EDIT THIS
                '    Return TestAnalysis.Description    'EDIT THIS
            Case Else
                Return &quot;Description not found&quot;
        End Select
    End Function

    ''' &lt;summary&gt;
    ''' Factory method for creating an analysis instance
    ''' &lt;/summary&gt;
    ''' &lt;param name=&quot;analysisfunction&quot;&gt;the type of analysis instance to create&lt;/param&gt;
    ''' &lt;param name=&quot;seriesList&quot;&gt;list of input TimeSeries&lt;/param&gt;
    ''' &lt;returns&gt;the analysis instance&lt;/returns&gt;
    Public Function CreateAnalysis(analysisfunction As AnalysisFunctions, seriesList As List(Of TimeSeries)) As Analysis

        Dim oAnalysis As Analysis

        Select Case analysisfunction

            Case AnalysisFunctions.Accumulate
                oAnalysis = New Accumulate(seriesList)

            Case AnalysisFunctions.AnnualRecurrenceProbability
                oAnalysis = New AnnualRecurrenceProbability(seriesList)

            Case AnalysisFunctions.AnnualStatistics
                oAnalysis = New AnnualStatistics(seriesList)

            Case AnalysisFunctions.Autocorrelation
                oAnalysis = New Autocorrelation(seriesList)

            Case AnalysisFunctions.Calculator
                oAnalysis = New Calculator(seriesList)

            Case AnalysisFunctions.ChangeTimestep
                oAnalysis = New ChangeTimestep(seriesList)

            Case AnalysisFunctions.Comparison
                oAnalysis = New Comparison(seriesList)

            Case AnalysisFunctions.Decumulate
                oAnalysis = New Decumulate(seriesList)

            Case AnalysisFunctions.DoubleSumCurve
                oAnalysis = New DoubleSumCurve(seriesList)

            Case AnalysisFunctions.GoodnessOfFit
                oAnalysis = New GoodnessOfFit(seriesList)

            Case AnalysisFunctions.Histogram
                oAnalysis = New Histogram(seriesList)

            Case AnalysisFunctions.LinearRegression
                oAnalysis = New LinearRegression(seriesList)

            Case AnalysisFunctions.MonthlyStatistics
                oAnalysis = New MonthlyStatistics(seriesList)

            Case AnalysisFunctions.TimeShift
                oAnalysis = New TimeShift(seriesList)

            Case AnalysisFunctions.TimestepAnalysis
                oAnalysis = New TimeStepAnalysis(seriesList)

            'Case AnalysisFunctions.TestAnalysis             'EDIT THIS
            '    oAnalysis = New TestAnalysis(seriesList)    'EDIT THIS

            Case Else
                Throw New Exception(&quot;Analysis not found!&quot;)

        End Select

        Return oAnalysis

    End Function

End Module
</code></pre>
</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/bluemodel/BlueM.Wave/blob/master/docs/articles/analysis.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
